# 云函数配置标准

## 环境变量配置

### AI相关函数（必需配置）
以下函数需要配置OpenAI API相关环境变量：

**核心AI函数（4个）**
1. `ai-chat` - AI对话核心功能
2. `speech-recognition` - 语音识别（OpenAI Whisper）  
3. `text-to-speech` - 语音合成（OpenAI TTS）
4. `voice-assistant` - 语音助手WebSocket处理

**环境变量**
```
OPENAI_API_KEY=sk-MVwM0Y77CDZbTMT0cFoDe5WSZuYZk1G64dMWE6hpBitqgkgT
OPENAI_API_BASE=https://www.chataiapi.com/v1
```

### 业务功能函数（无需特殊配置）
以下函数使用CloudBase默认环境：
1. `getWordbooks` - 获取词书列表
2. `getWordsByWordbook` - 获取词书单词  
3. `upload-wordbook` - 词书上传
4. `fsrs-service` - 学习算法服务
5. `daily-plan` - 每日计划生成
6. `user-settings` - 用户设置
7. `userInfo` - 用户信息

### 认证函数（可选配置）
1. `auth-new` - 新认证系统（可能需要第三方API配置）

## 函数规范

### 命名规范
- 使用小写字母和连字符
- 功能清晰明确
- 避免版本号后缀（如-new, -v2等）

### 超时配置  
- 普通业务函数：30秒
- AI相关函数：30-60秒（根据API响应时间）
- 文件处理函数：60-120秒

### 内存配置
- 轻量函数：128MB
- 普通函数：256MB  
- 重型处理：512MB

### 日志配置
- 统一使用tcb-default日志格式
- 启用公网访问（ENABLE）
- 云端安装依赖（TRUE）

## 已清理的函数

### 已删除（本地）
- `getEnvInfo` - 有bug的环境信息函数
- `test-simple` - 测试函数

### 待删除（需手动操作云端）
1. `auth` (CreateFailed)
2. `verifyLogin` (CreateFailed)
3. `sendSms` (CreateFailed)
4. `test-simple` (Active)
5. `test-auth` (Active)
6. `hello` (Active)
7. `auth-backup` (Active)
8. `voice-chat` (Active) - 与voice-assistant重复

## 维护建议

1. **定期检查**：每月检查函数状态和使用情况
2. **版本管理**：避免创建过多版本，及时清理旧版本
3. **监控告警**：设置函数执行失败告警
4. **成本控制**：监控函数调用量和费用
5. **安全更新**：定期更新API密钥和依赖包